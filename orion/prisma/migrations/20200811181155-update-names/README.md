# Migration `20200811181155-update-names`

This migration has been generated by gatz at 8/11/2020, 8:11:55 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."file_path_tags" ALTER COLUMN "tag.id" SET NOT NULL,
ALTER COLUMN "file_path.id" SET NOT NULL;

CREATE SEQUENCE "ioc_intel_id_seq";;
ALTER TABLE "public"."ioc_intel" ALTER COLUMN "id" SET DEFAULT nextval('ioc_intel_id_seq');;;
ALTER SEQUENCE "ioc_intel_id_seq" OWNED BY "public"."ioc_intel"."id";

ALTER TABLE "public"."node_tags" ALTER COLUMN "tag.id" SET NOT NULL,
ALTER COLUMN "node.id" SET NOT NULL;

ALTER TABLE "public"."pack_tags" ALTER COLUMN "tag.id" SET NOT NULL,
ALTER COLUMN "pack.id" SET NOT NULL;

ALTER TABLE "public"."query_packs" ALTER COLUMN "pack.id" SET NOT NULL,
ALTER COLUMN "query.id" SET NOT NULL;

ALTER TABLE "public"."query_tags" ALTER COLUMN "tag.id" SET NOT NULL,
ALTER COLUMN "query.id" SET NOT NULL;

CREATE UNIQUE INDEX "file_path_tags.tag.id_file_path.id_unique" ON "public"."file_path_tags"("tag.id","file_path.id")

CREATE UNIQUE INDEX "node_tags.node.id_tag.id_unique" ON "public"."node_tags"("node.id","tag.id")

CREATE UNIQUE INDEX "pack_tags.pack.id_tag.id_unique" ON "public"."pack_tags"("pack.id","tag.id")

CREATE UNIQUE INDEX "query_packs.pack.id_query.id_unique" ON "public"."query_packs"("pack.id","query.id")

CREATE UNIQUE INDEX "query_tags.tag.id_query.id_unique" ON "public"."query_tags"("tag.id","query.id")

ALTER INDEX "public"."distributed_query_task_guid_key" RENAME TO "distributed_query_task.guid_unique"

ALTER INDEX "public"."file_path_category_key" RENAME TO "file_path.category_unique"

ALTER INDEX "public"."node_node_key_key" RENAME TO "node.node_key_unique"

ALTER INDEX "public"."node_config_name_key" RENAME TO "node_config.name_unique"

ALTER INDEX "public"."index_node_recon_data_on_columns" RENAME TO "index_node_recon_data_on_columns_path"

ALTER INDEX "public"."index_node_recon_data_on_columns_path" RENAME TO "index_node_recon_data_on_columns"

ALTER INDEX "public"."pack_name_key" RENAME TO "pack.name_unique"

ALTER INDEX "public"."index_result_log_on_columns" RENAME TO "index_result_log_on_columns_path"

ALTER INDEX "public"."index_result_log_on_columns_path" RENAME TO "index_result_log_on_columns"

ALTER INDEX "public"."tag_value_key" RENAME TO "tag.value_unique"

ALTER INDEX "public"."user_username_key" RENAME TO "user.username_unique"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200809215948-test..20200811181155-update-names
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model alembic_version {
   version_num String @id
@@ -18,13 +18,13 @@
   node_id    Int
   body       String
   created_at DateTime
   updated_at DateTime
-  alerts     alerts   @relation(fields: [alert_id], references: [id])
+  alert      alert    @relation(fields: [alert_id], references: [id])
   node       node     @relation(fields: [node_id], references: [id])
 }
-model alerts {
+model alert {
   id                Int                 @default(autoincrement()) @id
   message           Json?
   query_name        String
   created_at        DateTime
@@ -40,8 +40,10 @@
   node              node                @relation(fields: [node_id], references: [id])
   rule              rule?               @relation(fields: [rule_id], references: [id])
   alert_email       alert_email[]
   distributed_query distributed_query[]
+
+  @@map(name: "alerts")
 }
 model carved_block {
   id         Int      @default(autoincrement()) @id
@@ -70,24 +72,28 @@
   updated_at       DateTime?
   node             node      @relation(fields: [node_id], references: [id])
 }
-model dashboard_data {
+model dashboard {
   id         Int      @default(autoincrement()) @id
   created_at DateTime
   updated_at DateTime
   name       String?
   data       Json?
+
+  @@map(name: "dashboard_data")
 }
-model default_filters {
+model default_filter {
   id               Int      @default(autoincrement()) @id
   filters          Json?
   platform         String
   apply_by_default Boolean
   created_at       DateTime
   updated_at       DateTime
   arch             String
+
+  @@map(name: "default_filters")
 }
 model default_query {
   id          Int      @default(autoincrement()) @id
@@ -111,9 +117,9 @@
   timestamp                DateTime?
   not_before               DateTime?
   description              String?
   alert_id                 Int?
-  alerts                   alerts?                    @relation(fields: [alert_id], references: [id])
+  alert                    alert?                     @relation(fields: [alert_id], references: [id])
   distributed_query_result distributed_query_result[]
   distributed_query_task   distributed_query_task[]
 }
@@ -155,23 +161,24 @@
   updated_at DateTime
 }
 model file_path {
-  id             Int              @default(autoincrement()) @id
-  category       String           @unique
-  target_paths   String?
-  file_path_tags file_path_tags[]
+  id            Int             @default(autoincrement()) @id
+  category      String          @unique
+  target_paths  String?
+  file_path_tag file_path_tag[]
 }
 // The underlying table does not contain a valid unique identifier and can therefore currently not be handled.
-model file_path_tags {
+model file_path_tag {
   tag_id       Int       @map("tag.id")
   file_path_id Int       @map("file_path.id")
   file_path    file_path @relation(fields: [file_path_id], references: [id])
   tag          tag       @relation(fields: [tag_id], references: [id])
   @@unique([tag_id, file_path_id])
   @@index([file_path_id], name: "ix_file_path_tags_file_path.id")
+  @@map(name: "file_path_tags")
 }
 model handling_token {
   id            Int       @default(autoincrement()) @id
@@ -220,17 +227,17 @@
   last_config            DateTime?
   last_query_read        DateTime?
   last_query_write       DateTime?
   alert_email            alert_email[]
-  alerts                 alerts[]
+  alert                  alert[]
   carve_session          carve_session[]
   distributed_query_task distributed_query_task[]
-  node_data              node_data[]
+  node_detail            node_detail[]
   node_email             node_email[]
-  // node_tags           node_tags[]
+  // node_tag           node_tag[]
   result_log             result_log[]
   status_log             status_log[]
-  node_tags              node_tags[]
+  node_tag               node_tag[]
 }
 model node_config {
   id               Int       @default(autoincrement()) @id
@@ -242,17 +249,19 @@
   updated_at       DateTime
   platform         String?
 }
-model node_data {
-  id              Int               @default(autoincrement()) @id
-  name            String
-  data            Json
-  node_id         Int
-  created_at      DateTime
-  updated_at      DateTime
-  node            node              @relation(fields: [node_id], references: [id])
-  node_recon_data node_recon_data[]
+model node_detail {
+  id         Int          @default(autoincrement()) @id
+  name       String
+  data       Json
+  node_id    Int
+  created_at DateTime
+  updated_at DateTime
+  node       node         @relation(fields: [node_id], references: [id])
+  node_recon node_recon[]
+
+  @@map(name: "node_data")
 }
 model node_email {
   id                 Int      @default(autoincrement()) @id
@@ -265,62 +274,64 @@
   updated_at         DateTime
   node               node     @relation(fields: [node_id], references: [id])
 }
-model node_recon_data {
-  id           Int       @default(autoincrement()) @id
+model node_recon {
+  id           Int         @default(autoincrement()) @id
   columns      Json
   node_data_id Int
   created_at   DateTime
   updated_at   DateTime
-  node_data    node_data @relation(fields: [node_data_id], references: [id])
+  node_detail  node_detail @relation(fields: [node_data_id], references: [id])
   @@index([columns], name: "index_node_recon_data_on_columns")
   @@index([columns], name: "index_node_recon_data_on_columns_path")
+  @@map(name: "node_recon_data")
 }
 // The underlying table does not contain a valid unique identifier and can therefore currently not be handled.
-model node_tags {
+model node_tag {
   tag_id  Int  @map("tag.id")
   node_id Int  @map("node.id")
   node    node @relation(fields: [node_id], references: [id])
   tag     tag  @relation(fields: [tag_id], references: [id])
   @@index([node_id], name: "ix_node_tags_node.id")
   @@unique([node_id, tag_id])
+  @@map(name: "node_tags")
 }
-model options {
+model option {
   id         Int       @default(autoincrement()) @id
   name       String
   option     String
   created_at DateTime?
   updated_at DateTime
+
+  @@map(name: "options")
 }
 model pack {
-  id          Int           @default(autoincrement()) @id
-  name        String        @unique
+  id          Int          @default(autoincrement()) @id
+  name        String       @unique
   platform    String?
   version     String?
   description String?
   shard       Int?
   category    String?
-  // pack_tags   pack_tags[]
-  // query_packs query_packs[]
-  pack_tags   pack_tags[]
-  query_packs query_packs[]
+  pack_tags   pack_tag[]
+  query_packs query_pack[]
 }
-// The underlying table does not contain a valid unique identifier and can therefore currently not be handled.
-model pack_tags {
+model pack_tag {
   tag_id  Int  @map("tag.id")
   pack_id Int  @map("pack.id")
   pack    pack @relation(fields: [pack_id], references: [id])
   tag     tag  @relation(fields: [tag_id], references: [id])
   @@index([pack_id], name: "ix_pack_tags_pack.id")
   @@unique([pack_id, tag_id])
+  @@map(name: "pack_tags")
 }
 model phish_tank {
   id         Int      @default(autoincrement()) @id
@@ -333,9 +344,9 @@
   updated_at DateTime
 }
 model query {
-  id          Int           @default(autoincrement()) @id
+  id          Int          @default(autoincrement()) @id
   name        String
   sql         String
   interval    Int?
   platform    String?
@@ -344,33 +355,31 @@
   value       String?
   removed     Boolean
   shard       Int?
   snapshot    Boolean?
-  // query_packs query_packs[]
-  // query_tags  query_tags[]
-  query_packs query_packs[]
-  query_tags  query_tags[]
+  query_packs query_pack[]
+  query_tags  query_tag[]
 }
-// The underlying table does not contain a valid unique identifier and can therefore currently not be handled.
-model query_packs {
+model query_pack {
   pack_id  Int   @map("pack.id")
   query_id Int   @map("query.id")
   pack     pack  @relation(fields: [pack_id], references: [id])
   query    query @relation(fields: [query_id], references: [id])
   @@unique([pack_id, query_id])
+  @@map(name: "query_packs")
 }
-// The underlying table does not contain a valid unique identifier and can therefore currently not be handled.
-model query_tags {
+model query_tag {
   tag_id   Int   @map("tag.id")
   query_id Int   @map("query.id")
   query    query @relation(fields: [query_id], references: [id])
   tag      tag   @relation(fields: [tag_id], references: [id])
   @@index([query_id], name: "ix_query_tags_query.id")
-  @@id([tag_id, query_id])
+  @@unique([tag_id, query_id])
+  @@map(name: "query_tags")
 }
 model result_log {
   id        Int       @default(autoincrement()) @id
@@ -409,17 +418,19 @@
   severity      String?
   tactics       String[]
   technique_id  String?
   type          String?
-  alerts        alerts[]
+  alert         alert[]
 }
-model settings {
+model setting {
   id         Int       @default(autoincrement()) @id
   name       String
   setting    String
   created_at DateTime?
   updated_at DateTime
+
+  @@map(name: "settings")
 }
 model status_log {
   id       Int       @default(autoincrement()) @id
@@ -435,20 +446,22 @@
   @@index([node_id, created], name: "idx_status_log_node_id_created_desc")
 }
 model tag {
-  id             Int              @default(autoincrement()) @id
-  value          String           @unique
-  file_path_tags file_path_tags[]
-  node_tags      node_tags[]
-  pack_tags      pack_tags[]
-  query_tags     query_tags[]
+  id            Int             @default(autoincrement()) @id
+  value         String          @unique
+  file_path_tag file_path_tag[]
+  node_tag      node_tag[]
+  pack_tags     pack_tag[]
+  query_tags    query_tag[]
 }
-model threat_intel_credentials {
+model threat_intel_credential {
   id          Int     @default(autoincrement()) @id
   intel_name  String?
   credentials Json
+
+  @@map(name: "threat_intel_credentials")
 }
 model user {
   id         Int      @default(autoincrement()) @id
```


